
@{
    ViewBag.Title = "Map";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=gb2312" />
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBB60Ip9iv28WTdf-vLI1guI2wM0GxyS5Y" type="text/javascript"></script>
</head>
<body onload="load()" onunload="GUnload()">
    <div style="width:100%;height:200px;margin-top:200px">
        <h1 id="demo">Get your location：</h1>
        <button onclick="getLocation()">Allow</button>
    </div>

    <!--以下id为googleMap的DIV元素即为Google地图的容器-->
    <div id="googleMap" style="width:100%;height:600px;"></div>
    <script>
        // 初始化地图
        function initialize() {
            var data = JSON.parse('@ViewBag.data');
            var mapProp = {
                center: new google.maps.LatLng(-25.344, 131.036),
                zoom: 4,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

            var locations = [];
            for (var i = 0; i < 50; i++) {
                var point = {
                    "lat": data[0][i],
                    "lng": data[1][i],
                };
                locations.push(point);
            }
           
            // Push them all into an array.
           
            var markers = locations.map(function (location, i) {
                return new google.maps.Marker({
                    position: location,
                    map: map,
                });
            });

        };
        google.maps.event.addDomListener(window, 'load', initialize);

        var x = document.getElementById("demo");
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            }
            else { x.innerHTML = "Geolocation is not supported by this browser."; }
        };
        function showPosition(position) {
            //x.innerHTML = "Latitude: " + position.coords.latitude +
            //    "<br />Longitude: " + position.coords.longitude;
            map.setCenter(new google.maps.LatLng(position.coords.latitude, position.coords.longitude));

            var marker = new google.maps.Marker({
                position: { lat: position.coords.latitude, lng: position.coords.longitude },
                map: map,
            });
        };
    </script>
</body>
</html>

