@model IEnumerable<foodary.Models.FoodEvent>

@{
    ViewBag.Title = "Map";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=gb2312" />
    <link href="~/DataTables-1.10.21/media/css/dataTables.bootstrap.css" rel="stylesheet" />
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="~/DataTables-1.10.21/media/css/jquery.dataTables.css" />
   

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBB60Ip9iv28WTdf-vLI1guI2wM0GxyS5Y" type="text/javascript"></script>
</head>
<body onload="load()" onunload="GUnload()">
    <div style="width:100%;height:50px;margin-top:200px;margin-left:300px">
        @*<h1 id="demo">Get your location：</h1>*@
        <button onclick="getLocation()">Get your location</button>
    </div>

    <!--以下id为googleMap的DIV元素即为Google地图的容器-->
    <div id="googleMap" style="width:40%;height:600px;margin-left:50px"></div>
    <div style="margin-top:100px;">
        <table class="table" id="table" >
            <thead>
                <tr>
                    <th>
                        @Html.DisplayNameFor(model => model.Name)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.What)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Address)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Suburb)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Phone)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Website)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Monday)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Tuesday)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Wednesday)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Thursday)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Friday)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Saturday)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Sunday)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Public_holidays)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Cost)
                    </th>
                    @*<th>
                        @Html.DisplayNameFor(model => model.Longitude)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Latitude)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Geocoded_location)
                    </th>*@
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.Name)
                        </td>
                        <td style="text-overflow:clip;overflow:hidden;width:15px;">
                            @Html.DisplayFor(modelItem => item.What)
                        </td>
                        <td style="text-overflow:clip;overflow:hidden;width:15px;">
                            @Html.DisplayFor(modelItem => item.Address)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Suburb)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Phone)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Website)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Monday)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Tuesday)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Wednesday)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Thursday)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Friday)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Saturday)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Sunday)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Public_holidays)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Cost)
                        </td>
                        @*<td>
                            @Html.DisplayFor(modelItem => item.Longitude)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Latitude)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Geocoded_location)
                        </td>*@
                        <td>
                            @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                            @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                            @Html.ActionLink("Delete", "Delete", new { id = item.Id })
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
    <script src="~/js/bootstrap.min.js"></script>
    <script type="text/javascript" charset="utf8" src="~/DataTables-1.10.21/media/js/jquery.js"></script>
    <!-- DataTables -->
    <script type="text/javascript" charset="utf8" src="~/DataTables-1.10.21/media/js/jquery.dataTables.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            $('#table').DataTable();
        });

        // 初始化地图
        function initialize() {
            @*var list = JSON.parse(@ViewBag.name);
            <!--<!--var name =@ViewBag.name;-->-->*@

            //var list = name.parseJSON();
            //alert(list)
            var data = JSON.parse('@ViewBag.data');
            @*var obj = JSON.parse(@ViewBag.models';
            aler*@
            //alert(datat(obj);)

            var mapProp = {
                center: new google.maps.LatLng(-37.822, 144.95),
                zoom: 12,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

            var locations = [];
            for (var i = 0; i < 50; i++) {
                var point = {
                    "lat": data[0][i],
                    "lng": data[1][i],
                };
                locations.push(point);
            }

            // Push them all into an array.

            var markers = locations.map(function (location, i) {
                return new google.maps.Marker({
                    position: location,
                    map: map,
                    //title: data[0][i] + '---' + data[1][i],
                });
            });

        };
        google.maps.event.addDomListener(window, 'load', initialize);

        var x = document.getElementById("demo");
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            }
            else { x.innerHTML = "Geolocation is not supported by this browser."; }
        };
        function showPosition(position) {
            //x.innerHTML = "Latitude: " + position.coords.latitude +
            //    "<br />Longitude: " + position.coords.longitude;
            map.setCenter(new google.maps.LatLng(position.coords.latitude, position.coords.longitude));

            var marker = new google.maps.Marker({
                position: { lat: position.coords.latitude, lng: position.coords.longitude },
                map: map,
            });
        };
    </script>
</body>
</html>

